# Setting Up OAuth 2.0 for QuickBooks Online

## Overview

OAuth 2.0 is used to implement authentication and authorization for QuickBooks Online apps. This process is essential for both sandbox testing and production applications.

This guide will walk you through setting up the authorization flow so users can authorize your app and grant it access to their QuickBooks Online company.

If users grant permission, the Intuit OAuth 2.0 Server returns an authorization code to your app. Your app then exchanges this code for access tokens. These tokens are tied to the user’s QuickBooks Online company (identified by the realmID).

Your app requires access tokens to make API calls and interact with QuickBooks Online data.

---

## Step 1: Create Your App on the Intuit Developer Portal

1. Sign in to your Intuit Developer account.
2. Create a new app.
3. Select the **QuickBooks Online Accounting** scope.
4. Your app will generate credentials needed for authorization requests.

---

## Step 2: Practice Authorization in the OAuth Playground

- Use the OAuth Playground to preview each step of the authorization flow.
- Sample data, like the redirect URI, is provided to help focus on the flow.
- This step is optional but recommended.

---

## Step 3: Start Developing with an SDK

Intuit provides SDKs that include an OAuth 2.0 Client Library, handling many authorization tasks automatically.

### Available SDKs:
- [.NET](https://developer.intuit.com/docs/sdk/dotnet)
- [Java](https://developer.intuit.com/docs/sdk/java)
- [PHP](https://developer.intuit.com/docs/sdk/php)
- [Node.js](https://developer.intuit.com/docs/sdk/nodejs)
- [Python](https://developer.intuit.com/docs/sdk/python)
- [Ruby](https://developer.intuit.com/docs/sdk/ruby)

#### Example: Installing the .NET SDK
```sh
Install-Package IppDotNetSdkForQuickBooksApiV3
```

*Note: SDKs are not required but are recommended for implementing OAuth 2.0.*

---

## Step 4: Understand the End-to-End Authorization Flow

While authorization appears simple for users, the backend process involves several steps:

### Creating Authorization Requests
- Review selected scopes to define data and API access.
- Configure credentials (Client ID, Client Secret, Redirect URIs).
- Use the authorization discovery document to get base URLs.
- Use this information to create authorization requests.

### Managing the Authorization Flow
1. The user connects to your app, which sends an authorization request to the Intuit OAuth 2.0 Server.
2. The user is redirected to an authorization page to grant permissions.
3. If authorized, the server sends an authorization code back to your app.

### Getting Access and Refresh Tokens
- Your app exchanges the authorization code for access and refresh tokens.
- The response contains the latest access and refresh tokens.

### Making API Calls
- Use access tokens to call APIs and interact with QuickBooks Online data.
- Refresh tokens allow access token renewal.
- If refresh tokens expire, users must go through the authorization flow again.

---

## Step 5: Get Your App’s Credentials

1. Sign in to your Intuit Developer account.
2. Retrieve your **Client ID** and **Client Secret** from the **Keys & OAuth** section.
   - Use the **Production** section for live apps.
   - Use the **Development** section for sandbox testing.

---

## Step 6: Learn About Discovery Documents

OAuth 2.0 requires multiple URLs for authentication and resource requests.
- Intuit provides discovery documents that contain JSON data with field-value pairs and endpoints for authorization, tokens, and user information.

---

## Step 7: Add Your App’s Redirect URIs

- Redirect URIs handle responses from the Intuit OAuth 2.0 Server.
- You must add at least one redirect URI for your app.
- If using an SDK, use the URI generated by the SDK.

**Best Practice:** Ensure endpoints do not expose authorization codes to other page resources.

---

## Step 8: Create an Authorization Request

Your app must send an authorization request to the Intuit OAuth 2.0 Server when users connect.

### Authorization Request Parameters
| Field         | Description | Required |
|--------------|-------------|----------|
| `client_id`  | Identifies the requesting app. Retrieved in Step 5. | Yes |
| `scope`      | Lists requested scopes (space-delimited). Defines accessible data. | Yes |
| `redirect_uri` | Specifies where users are redirected after authorization. Must match Step 7. | Yes |
| `response_type` | Always set to `code` to request an authorization code. | Yes |
| `state`      | Used for request validation and CSRF protection. Recommended to include an anti-forgery token. | Yes |
| `claims`     | (Optional) JSON object specifying requested user claims via OpenID Connect. | No |

**Important:** Authorization requests must be made within a browser modal. If your app lacks browser support, use tools like OAuth Playground or Postman.

### Example: Authorization Request in JavaScript (Node.js)
```javascript
// Instance of client
var oauthClient = new OAuthClient({
    clientId: '<Enter your clientId>',
    clientSecret: '<Enter your clientSecret>',
    environment: 'sandbox',
    redirectUri: '<Enter your redirectUri>'
});

// Generate Authorization URI
var authUri = oauthClient.authorizeUri({
    scope: [OAuthClient.scopes.Accounting, OAuthClient.scopes.OpenId],
    state: 'testState'
});
```

If you are manually creating an HTTPS/REST request, you must:
1. Get the base URI from the discovery document.
2. Use the authorization_endpoint values.

Links for different environments:
- [Sandbox Testing](https://developer.intuit.com/docs/quickbooks_sandbox)
- [Production](https://developer.intuit.com/docs/quickbooks_production)

---

## Step 9: Redirect Users to the Authorization Page

Your app must redirect users to the authorization page so they can grant access.

---

## Conclusion

This guide provides an overview of setting up OAuth 2.0 for QuickBooks Online. By following these steps, you can authenticate users, obtain access tokens, and interact with QuickBooks Online data securely.

For further details, refer to the [Intuit Developer Documentation](https://developer.intuit.com/docs).